generator client {
  provider = "prisma-client-js"
}

generator erd {
  provider = "prisma-erd-generator"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model campanha {
  id         Int             @id @default(autoincrement())
  nome       String
  descricao  String?
  meta       Decimal         @db.Decimal(10, 2)
  arrecadado Decimal         @default(0.00) @db.Decimal(10, 2)
  status     campanha_status @default(ativa)
  dataInicio DateTime        @default(now())
  dataFim    DateTime?
  idOng      Int
  ong        ong             @relation(fields: [idOng], references: [id], map: "Campanha_idOng_fkey")
  doacao     doacao[]

  @@index([idOng], map: "Campanha_idOng_fkey")
}

model doacao {
  id         Int        @id @default(autoincrement())
  valor      Decimal    @db.Decimal(10, 2)
  dataDoacao DateTime   @default(now())
  idUsuario  Int
  idCampanha Int
  campanha   campanha   @relation(fields: [idCampanha], references: [id], map: "Doacao_idCampanha_fkey")
  usuario    usuario    @relation(fields: [idUsuario], references: [id], map: "Doacao_idUsuario_fkey")
  transacao  transacao?

  @@index([idCampanha], map: "Doacao_idCampanha_fkey")
  @@index([idUsuario], map: "Doacao_idUsuario_fkey")
}

model ong {
  id           Int        @id @default(autoincrement())
  nome         String
  cnpj         String     @unique(map: "Ong_cnpj_key")
  email        String     @unique(map: "Ong_email_key")
  senha        String
  telefone     String?
  descricao    String?
  status       ong_status @default(pendente)
  dataCadastro DateTime   @default(now())
  campanha     campanha[]
}

model transacao {
  id              Int                       @id @default(autoincrement())
  metodoPagamento transacao_metodoPagamento
  codigoTransacao String?                   @unique(map: "Transacao_codigoTransacao_key")
  status          transacao_status          @default(pendente)
  dataPagamento   DateTime?
  idDoacao        Int                       @unique(map: "Transacao_idDoacao_key")
  doacao          doacao                    @relation(fields: [idDoacao], references: [id], map: "Transacao_idDoacao_fkey")
}

model usuario {
  id          Int          @id @default(autoincrement())
  cpf         String       @unique(map: "Usuario_cpf_key")
  nome        String
  email       String       @unique(map: "Usuario_email_key")
  senha       String
  tipo        usuario_tipo @default(parceiro)
  dataCriacao DateTime     @default(now())
  doacao      doacao[]
}

enum transacao_metodoPagamento {
  pix
}

enum transacao_status {
  pendente
  aprovada
  rejeitada
  ativa
  encerrada
}

enum campanha_status {
  pendente
  aprovada
  rejeitada
  ativa
  encerrada
}

enum usuario_tipo {
  parceiro
  ong
  admin
}

enum ong_status {
  pendente
  aprovada
  rejeitada
  ativa
  encerrada
}
